{"version":3,"sources":["angular-preload-image.js"],"names":["angular","module","constant","firstStep","step","className","defaultSpinner","factory","Settings","$timeout","listenForEl","url","img","successCallback","errorCallback","timeout","element","bind","this","cleanData","remove","console","log","attr","outdatedTry","limit","Math","pow","Image","directive","preLoader","$window","restrict","terminal","priority","link","scope","$element","attrs","ngSrc","spinner","defaultImage","after","$spinner","toggleClass","$set","complete","src","class","next","css","innerHeight","watch","$watch","addClass","background-image","$on","preloadBgImage"],"mappings":"CAAA,SAAWA,GACT,YAEAA,GAAQC,OAAO,4BAEdC,SAAS,YACRC,UAAW,IACXC,KAAM,EACNC,UAAW,uBACXC,eAAgB,2kIAGjBC,QAAQ,aAAc,WAAY,YAAa,SAAUC,EAAUC,GAClE,GAAIC,GAAc,SAAUC,EAAKC,EAAKC,EAAiBC,EAAeC,GACpEf,EAAQgB,QAAQJ,GACfK,KAAK,OAAQ,WACZJ,EAAgBK,MAChBlB,EAAQgB,QAAQE,MAAMC,YAAYC,SAClCC,QAAQC,IAAIJ,QACXD,KAAK,QAAS,WACfH,EAAcC,GACdf,EAAQgB,QAAQE,MAAMC,YAAYC,SAClCC,QAAQC,IAAIJ,QACXK,KAAK,MAAOZ,IAIba,EAAc,SAASb,EAAKI,EAASU,EAAOZ,EAAiBC,GAC3DN,EAASL,UAAYuB,KAAKC,IAAInB,EAASJ,KAAMqB,EAAQ,KAAOV,GAIhEN,EACE,WACEC,EAAYC,EAAK,GAAIiB,OAASf,EAAiBC,EAAeC,IAEhEA,GAIJ,QACEL,YAAaA,EACbc,YAAaA,KAIhBK,UAAU,gBAAiB,YAAa,WAAY,UAAW,WAC9D,SAAUC,EAAWrB,EAAUsB,EAASvB,GAEtC,OACEwB,SAAU,IACVC,UAAU,EACVC,SAAU,IACVC,KAAM,SAAUC,EAAOC,EAAUC,GAC/B,GAAI3B,GAAM2B,EAAMC,MACZd,EAAQa,EAAMb,MACde,EAAUF,EAAMG,cAAgBjC,EAASF,eAEzCH,EAAYK,EAASL,UACrBE,EAAYG,EAASH,SAEzB,IAAKM,EAAL,CAQA,GAJA0B,EAASK,MAAMC,GAAUC,YAAYvC,GAErCiC,EAAMO,KAAK,MAAOlC,GAEd0B,EAAS,GAAGS,SAEd,MADAT,GAASO,YAAYvC,GACrB,MAGF,IAAIsC,GAAW3C,EAAQgB,QAAQ,GAAIY,QAASL,MAAQwB,IAAOP,EAASQ,QAAS3C,EAAY,YAEzFgC,GAASK,MAAMC,GAEfb,EAAUN,YAAY,EAAGC,GAAS,EAAG,WACnCY,EAASY,OAAO7B,SAChBiB,EAASa,IAAI,aAAcnB,EAAQoB,YAAc,MACjD1C,EAAS,WACP4B,EAASO,YAAYvC,IACpB,MACF,SAASU,GACVe,EAAUN,YAAsB,EAAVT,GAAeZ,EAAWQ,EAAK2B,EAAOD,WAOrER,UAAU,kBAAmB,YAAa,WAAY,WACrD,SAAUC,EAAWrB,EAAUD,GAE7B,OACEwB,SAAU,IACVG,KAAM,SAAUC,EAAOC,EAAUC,GAC/B,GAAInC,GAAYK,EAASL,UACrBC,EAAOI,EAASJ,KAChBC,EAAYG,EAASH,UAErBoB,EAAQa,EAAMb,MACde,EAAUF,EAAMG,cAAgBjC,EAASF,eAEzC8C,EAAQhB,EAAMiB,OAAO,iBAAkB,SAAS1C,GAC7CA,IAIL0B,EAASiB,SAASjD,GAAW6C,KAC3BK,mBAAoB,QAAUf,EAAU,OAG1CV,EAAUN,YAAYb,EAAK,EAAGc,GAAS,EAAG,WACxCY,EAASa,KACPK,mBAAoB,QAAU5C,EAAM,OACnCiC,YAAYvC,IACd,SAASU,GACVe,EAAUN,YAAYT,EAAUX,GAAQD,EAAWkC,EAAUZ,EAAOd,QAGrE,EAEHyB,GAAMoB,IAAI,WAAY,WACpBJ,OAIJhB,OACEqB,eAAgB,UAMvBzD","file":"angular-preload-image.min.js","sourcesContent":["(function (angular) {\n  'use strict';\n\n  angular.module('angular-preload-image', [])\n\n  .constant('Settings', {\n    firstStep: 1000,\n    step: 2,\n    className: 'ng-preloader-loading',\n    defaultSpinner: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0nMzJweCcgaGVpZ2h0PSczMnB4JyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJ4TWlkWU1pZCIgY2xhc3M9InVpbC1kZWZhdWx0Ij48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0ibm9uZSIgY2xhc3M9ImJrIj48L3JlY3Q+PHJlY3QgIHg9JzQ2LjUnIHk9JzQwJyB3aWR0aD0nNycgaGVpZ2h0PScyMCcgcng9JzUnIHJ5PSc1JyBmaWxsPScjODg4ODg4JyB0cmFuc2Zvcm09J3JvdGF0ZSgwIDUwIDUwKSB0cmFuc2xhdGUoMCAtMzApJz4gIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9J29wYWNpdHknIGZyb209JzEnIHRvPScwJyBkdXI9Jy43cycgYmVnaW49JzBzJyByZXBlYXRDb3VudD0naW5kZWZpbml0ZScvPjwvcmVjdD48cmVjdCAgeD0nNDYuNScgeT0nNDAnIHdpZHRoPSc3JyBoZWlnaHQ9JzIwJyByeD0nNScgcnk9JzUnIGZpbGw9JyM4ODg4ODgnIHRyYW5zZm9ybT0ncm90YXRlKDMwIDUwIDUwKSB0cmFuc2xhdGUoMCAtMzApJz4gIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9J29wYWNpdHknIGZyb209JzEnIHRvPScwJyBkdXI9Jy43cycgYmVnaW49JzAuMDU4MzMzMzMzMzMzMzMzMzNzJyByZXBlYXRDb3VudD0naW5kZWZpbml0ZScvPjwvcmVjdD48cmVjdCAgeD0nNDYuNScgeT0nNDAnIHdpZHRoPSc3JyBoZWlnaHQ9JzIwJyByeD0nNScgcnk9JzUnIGZpbGw9JyM4ODg4ODgnIHRyYW5zZm9ybT0ncm90YXRlKDYwIDUwIDUwKSB0cmFuc2xhdGUoMCAtMzApJz4gIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9J29wYWNpdHknIGZyb209JzEnIHRvPScwJyBkdXI9Jy43cycgYmVnaW49JzAuMTE2NjY2NjY2NjY2NjY2NjVzJyByZXBlYXRDb3VudD0naW5kZWZpbml0ZScvPjwvcmVjdD48cmVjdCAgeD0nNDYuNScgeT0nNDAnIHdpZHRoPSc3JyBoZWlnaHQ9JzIwJyByeD0nNScgcnk9JzUnIGZpbGw9JyM4ODg4ODgnIHRyYW5zZm9ybT0ncm90YXRlKDkwIDUwIDUwKSB0cmFuc2xhdGUoMCAtMzApJz4gIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9J29wYWNpdHknIGZyb209JzEnIHRvPScwJyBkdXI9Jy43cycgYmVnaW49JzAuMTc0OTk5OTk5OTk5OTk5OTZzJyByZXBlYXRDb3VudD0naW5kZWZpbml0ZScvPjwvcmVjdD48cmVjdCAgeD0nNDYuNScgeT0nNDAnIHdpZHRoPSc3JyBoZWlnaHQ9JzIwJyByeD0nNScgcnk9JzUnIGZpbGw9JyM4ODg4ODgnIHRyYW5zZm9ybT0ncm90YXRlKDEyMCA1MCA1MCkgdHJhbnNsYXRlKDAgLTMwKSc+ICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSdvcGFjaXR5JyBmcm9tPScxJyB0bz0nMCcgZHVyPScuN3MnIGJlZ2luPScwLjIzMzMzMzMzMzMzMzMzMzNzJyByZXBlYXRDb3VudD0naW5kZWZpbml0ZScvPjwvcmVjdD48cmVjdCAgeD0nNDYuNScgeT0nNDAnIHdpZHRoPSc3JyBoZWlnaHQ9JzIwJyByeD0nNScgcnk9JzUnIGZpbGw9JyM4ODg4ODgnIHRyYW5zZm9ybT0ncm90YXRlKDE1MCA1MCA1MCkgdHJhbnNsYXRlKDAgLTMwKSc+ICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSdvcGFjaXR5JyBmcm9tPScxJyB0bz0nMCcgZHVyPScuN3MnIGJlZ2luPScwLjI5MTY2NjY2NjY2NjY2NjdzJyByZXBlYXRDb3VudD0naW5kZWZpbml0ZScvPjwvcmVjdD48cmVjdCAgeD0nNDYuNScgeT0nNDAnIHdpZHRoPSc3JyBoZWlnaHQ9JzIwJyByeD0nNScgcnk9JzUnIGZpbGw9JyM4ODg4ODgnIHRyYW5zZm9ybT0ncm90YXRlKDE4MCA1MCA1MCkgdHJhbnNsYXRlKDAgLTMwKSc+ICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSdvcGFjaXR5JyBmcm9tPScxJyB0bz0nMCcgZHVyPScuN3MnIGJlZ2luPScwLjM0OTk5OTk5OTk5OTk5OTlzJyByZXBlYXRDb3VudD0naW5kZWZpbml0ZScvPjwvcmVjdD48cmVjdCAgeD0nNDYuNScgeT0nNDAnIHdpZHRoPSc3JyBoZWlnaHQ9JzIwJyByeD0nNScgcnk9JzUnIGZpbGw9JyM4ODg4ODgnIHRyYW5zZm9ybT0ncm90YXRlKDIxMCA1MCA1MCkgdHJhbnNsYXRlKDAgLTMwKSc+ICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSdvcGFjaXR5JyBmcm9tPScxJyB0bz0nMCcgZHVyPScuN3MnIGJlZ2luPScwLjQwODMzMzMzMzMzMzMzMzI3cycgcmVwZWF0Q291bnQ9J2luZGVmaW5pdGUnLz48L3JlY3Q+PHJlY3QgIHg9JzQ2LjUnIHk9JzQwJyB3aWR0aD0nNycgaGVpZ2h0PScyMCcgcng9JzUnIHJ5PSc1JyBmaWxsPScjODg4ODg4JyB0cmFuc2Zvcm09J3JvdGF0ZSgyNDAgNTAgNTApIHRyYW5zbGF0ZSgwIC0zMCknPiAgPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0nb3BhY2l0eScgZnJvbT0nMScgdG89JzAnIGR1cj0nLjdzJyBiZWdpbj0nMC40NjY2NjY2NjY2NjY2NjY2cycgcmVwZWF0Q291bnQ9J2luZGVmaW5pdGUnLz48L3JlY3Q+PHJlY3QgIHg9JzQ2LjUnIHk9JzQwJyB3aWR0aD0nNycgaGVpZ2h0PScyMCcgcng9JzUnIHJ5PSc1JyBmaWxsPScjODg4ODg4JyB0cmFuc2Zvcm09J3JvdGF0ZSgyNzAgNTAgNTApIHRyYW5zbGF0ZSgwIC0zMCknPiAgPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0nb3BhY2l0eScgZnJvbT0nMScgdG89JzAnIGR1cj0nLjdzJyBiZWdpbj0nMC41MjVzJyByZXBlYXRDb3VudD0naW5kZWZpbml0ZScvPjwvcmVjdD48cmVjdCAgeD0nNDYuNScgeT0nNDAnIHdpZHRoPSc3JyBoZWlnaHQ9JzIwJyByeD0nNScgcnk9JzUnIGZpbGw9JyM4ODg4ODgnIHRyYW5zZm9ybT0ncm90YXRlKDMwMCA1MCA1MCkgdHJhbnNsYXRlKDAgLTMwKSc+ICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSdvcGFjaXR5JyBmcm9tPScxJyB0bz0nMCcgZHVyPScuN3MnIGJlZ2luPScwLjU4MzMzMzMzMzMzMzMzMzRzJyByZXBlYXRDb3VudD0naW5kZWZpbml0ZScvPjwvcmVjdD48cmVjdCAgeD0nNDYuNScgeT0nNDAnIHdpZHRoPSc3JyBoZWlnaHQ9JzIwJyByeD0nNScgcnk9JzUnIGZpbGw9JyM4ODg4ODgnIHRyYW5zZm9ybT0ncm90YXRlKDMzMCA1MCA1MCkgdHJhbnNsYXRlKDAgLTMwKSc+ICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSdvcGFjaXR5JyBmcm9tPScxJyB0bz0nMCcgZHVyPScuN3MnIGJlZ2luPScwLjY0MTY2NjY2NjY2NjY2NjZzJyByZXBlYXRDb3VudD0naW5kZWZpbml0ZScvPjwvcmVjdD48L3N2Zz4='\n  })\n\n  .factory('preLoader', ['Settings', '$timeout'], function (Settings, $timeout) {\n    var listenForEl = function (url, img, successCallback, errorCallback, timeout) {\n      angular.element(img)\n      .bind('load', function () {\n        successCallback(this);\n        angular.element(this).cleanData().remove();\n        console.log(this);\n      }).bind('error', function () {\n        errorCallback(timeout);\n        angular.element(this).cleanData().remove();\n        console.log(this);\n      }).attr('src', url);\n    };\n\n\n    var outdatedTry = function(url, timeout, limit, successCallback, errorCallback) {\n      if (Settings.firstStep * Math.pow(Settings.step, limit - 1) === timeout) {\n        return;\n      }\n\n      $timeout(\n        function() {\n          listenForEl(url, new Image(), successCallback, errorCallback, timeout);\n        },\n        timeout\n      );\n    };\n\n    return {\n      listenForEl: listenForEl,\n      outdatedTry: outdatedTry\n    };\n  })\n\n  .directive('preloadImage', ['preLoader', '$timeout', '$window', 'Settings',\n    function (preLoader, $timeout, $window, Settings) {\n\n      return {\n        restrict: 'A',\n        terminal: true,\n        priority: 100,\n        link: function (scope, $element, attrs) {\n          var url = attrs.ngSrc;\n          var limit = attrs.limit;\n          var spinner = attrs.defaultImage || Settings.defaultSpinner;\n\n          var firstStep = Settings.firstStep;\n          var className = Settings.className;\n\n          if (!url) {\n            return;\n          }\n\n          $element.after($spinner).toggleClass(className);\n\n          attrs.$set('src', url);\n\n          if ($element[0].complete) {\n            $element.toggleClass(className);\n            return;\n          }\n\n          var $spinner = angular.element(new Image()).attr( { 'src': spinner, 'class': className + '-spinner' });\n\n          $element.after($spinner);\n\n          preLoader.outdatedTry(0, limit || 0, function() {\n            $element.next().remove();\n            $element.css('max-height', $window.innerHeight + 'px');\n            $timeout(function() {\n              $element.toggleClass(className);\n            }, 300);\n          }, function(timeout) {\n            preLoader.outdatedTry(timeout * 2 || firstStep, url, attrs, $element);\n          });\n        }\n      };\n    }\n  ])\n\n  .directive('preloadBgImage', ['preLoader', '$timeout', 'Settings',\n    function (preLoader, $timeout, Settings) {\n\n      return {\n        restrict: 'A',\n        link: function (scope, $element, attrs) {\n          var firstStep = Settings.firstStep;\n          var step = Settings.step;\n          var className = Settings.className;\n\n          var limit = attrs.limit;\n          var spinner = attrs.defaultImage || Settings.defaultSpinner;\n\n          var watch = scope.$watch('preloadBgImage', function(url) {\n            if (!url) {\n              return;\n            }\n\n            $element.addClass(className).css({\n              'background-image': 'url(\"' + spinner + '\")'\n            });\n\n            preLoader.outdatedTry(url, 0, limit || 0, function() {\n              $element.css({\n                'background-image': 'url(\"' + url + '\")'\n              }).toggleClass(className);\n            }, function(timeout) {\n              preLoader.outdatedTry(timeout * step || firstStep, $element, limit, url);\n            });\n\n          }, true);\n\n          scope.$on('$destroy', function() {\n            watch();\n          });\n\n        },\n        scope: {\n          preloadBgImage: '@'\n        }\n      };\n    }\n  ]);\n\n})(angular);"],"sourceRoot":"/source/"}