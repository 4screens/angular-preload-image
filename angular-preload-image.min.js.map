{"version":3,"sources":["angular-preload-image.js"],"names":["angular","module","constant","firstStep","step","className","classNameHeight","bgClassName","defaultSpinner","factory","Settings","$timeout","listenForEl","$el","url","successCallback","errorCallback","timeout","one","console","log","src","attr","outdatedTry","limit","Math","pow","calculateHeight","width","originalWidth","originalHeight","parseInt","directive","preLoader","$window","restrict","terminal","priority","link","scope","$element","attrs","height","spinner","defaultImage","$testImage","element","Image","$spinner","class","next","remove","css","innerHeight","removeClass","off","success","$apply","ngSrc","$observe","complete","addClass","after","prop","$on","disconnectWatchers","background-image","_url"],"mappings":"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","file":"angular-preload-image.min.js","sourcesContent":["(function (angular) {\n  'use strict';\n\n  angular.module('angular-preload-image', [])\n\n  .constant('Settings', {\n    firstStep: 1000,\n    step: 2,\n    className: 'ng-preloader-loading',\n    classNameHeight: 'ng-preloader-loading-with-height',\n    bgClassName: 'ng-preloader-bg-loading',\n    defaultSpinner: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0nMzJweCcgaGVpZ2h0PSczMnB4JyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJ4TWlkWU1pZCIgY2xhc3M9InVpbC1kZWZhdWx0Ij48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0ibm9uZSIgY2xhc3M9ImJrIj48L3JlY3Q+PHJlY3QgIHg9JzQ2LjUnIHk9JzQwJyB3aWR0aD0nNycgaGVpZ2h0PScyMCcgcng9JzUnIHJ5PSc1JyBmaWxsPScjODg4ODg4JyB0cmFuc2Zvcm09J3JvdGF0ZSgwIDUwIDUwKSB0cmFuc2xhdGUoMCAtMzApJz4gIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9J29wYWNpdHknIGZyb209JzEnIHRvPScwJyBkdXI9Jy43cycgYmVnaW49JzBzJyByZXBlYXRDb3VudD0naW5kZWZpbml0ZScvPjwvcmVjdD48cmVjdCAgeD0nNDYuNScgeT0nNDAnIHdpZHRoPSc3JyBoZWlnaHQ9JzIwJyByeD0nNScgcnk9JzUnIGZpbGw9JyM4ODg4ODgnIHRyYW5zZm9ybT0ncm90YXRlKDMwIDUwIDUwKSB0cmFuc2xhdGUoMCAtMzApJz4gIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9J29wYWNpdHknIGZyb209JzEnIHRvPScwJyBkdXI9Jy43cycgYmVnaW49JzAuMDU4MzMzMzMzMzMzMzMzMzNzJyByZXBlYXRDb3VudD0naW5kZWZpbml0ZScvPjwvcmVjdD48cmVjdCAgeD0nNDYuNScgeT0nNDAnIHdpZHRoPSc3JyBoZWlnaHQ9JzIwJyByeD0nNScgcnk9JzUnIGZpbGw9JyM4ODg4ODgnIHRyYW5zZm9ybT0ncm90YXRlKDYwIDUwIDUwKSB0cmFuc2xhdGUoMCAtMzApJz4gIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9J29wYWNpdHknIGZyb209JzEnIHRvPScwJyBkdXI9Jy43cycgYmVnaW49JzAuMTE2NjY2NjY2NjY2NjY2NjVzJyByZXBlYXRDb3VudD0naW5kZWZpbml0ZScvPjwvcmVjdD48cmVjdCAgeD0nNDYuNScgeT0nNDAnIHdpZHRoPSc3JyBoZWlnaHQ9JzIwJyByeD0nNScgcnk9JzUnIGZpbGw9JyM4ODg4ODgnIHRyYW5zZm9ybT0ncm90YXRlKDkwIDUwIDUwKSB0cmFuc2xhdGUoMCAtMzApJz4gIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9J29wYWNpdHknIGZyb209JzEnIHRvPScwJyBkdXI9Jy43cycgYmVnaW49JzAuMTc0OTk5OTk5OTk5OTk5OTZzJyByZXBlYXRDb3VudD0naW5kZWZpbml0ZScvPjwvcmVjdD48cmVjdCAgeD0nNDYuNScgeT0nNDAnIHdpZHRoPSc3JyBoZWlnaHQ9JzIwJyByeD0nNScgcnk9JzUnIGZpbGw9JyM4ODg4ODgnIHRyYW5zZm9ybT0ncm90YXRlKDEyMCA1MCA1MCkgdHJhbnNsYXRlKDAgLTMwKSc+ICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSdvcGFjaXR5JyBmcm9tPScxJyB0bz0nMCcgZHVyPScuN3MnIGJlZ2luPScwLjIzMzMzMzMzMzMzMzMzMzNzJyByZXBlYXRDb3VudD0naW5kZWZpbml0ZScvPjwvcmVjdD48cmVjdCAgeD0nNDYuNScgeT0nNDAnIHdpZHRoPSc3JyBoZWlnaHQ9JzIwJyByeD0nNScgcnk9JzUnIGZpbGw9JyM4ODg4ODgnIHRyYW5zZm9ybT0ncm90YXRlKDE1MCA1MCA1MCkgdHJhbnNsYXRlKDAgLTMwKSc+ICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSdvcGFjaXR5JyBmcm9tPScxJyB0bz0nMCcgZHVyPScuN3MnIGJlZ2luPScwLjI5MTY2NjY2NjY2NjY2NjdzJyByZXBlYXRDb3VudD0naW5kZWZpbml0ZScvPjwvcmVjdD48cmVjdCAgeD0nNDYuNScgeT0nNDAnIHdpZHRoPSc3JyBoZWlnaHQ9JzIwJyByeD0nNScgcnk9JzUnIGZpbGw9JyM4ODg4ODgnIHRyYW5zZm9ybT0ncm90YXRlKDE4MCA1MCA1MCkgdHJhbnNsYXRlKDAgLTMwKSc+ICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSdvcGFjaXR5JyBmcm9tPScxJyB0bz0nMCcgZHVyPScuN3MnIGJlZ2luPScwLjM0OTk5OTk5OTk5OTk5OTlzJyByZXBlYXRDb3VudD0naW5kZWZpbml0ZScvPjwvcmVjdD48cmVjdCAgeD0nNDYuNScgeT0nNDAnIHdpZHRoPSc3JyBoZWlnaHQ9JzIwJyByeD0nNScgcnk9JzUnIGZpbGw9JyM4ODg4ODgnIHRyYW5zZm9ybT0ncm90YXRlKDIxMCA1MCA1MCkgdHJhbnNsYXRlKDAgLTMwKSc+ICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSdvcGFjaXR5JyBmcm9tPScxJyB0bz0nMCcgZHVyPScuN3MnIGJlZ2luPScwLjQwODMzMzMzMzMzMzMzMzI3cycgcmVwZWF0Q291bnQ9J2luZGVmaW5pdGUnLz48L3JlY3Q+PHJlY3QgIHg9JzQ2LjUnIHk9JzQwJyB3aWR0aD0nNycgaGVpZ2h0PScyMCcgcng9JzUnIHJ5PSc1JyBmaWxsPScjODg4ODg4JyB0cmFuc2Zvcm09J3JvdGF0ZSgyNDAgNTAgNTApIHRyYW5zbGF0ZSgwIC0zMCknPiAgPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0nb3BhY2l0eScgZnJvbT0nMScgdG89JzAnIGR1cj0nLjdzJyBiZWdpbj0nMC40NjY2NjY2NjY2NjY2NjY2cycgcmVwZWF0Q291bnQ9J2luZGVmaW5pdGUnLz48L3JlY3Q+PHJlY3QgIHg9JzQ2LjUnIHk9JzQwJyB3aWR0aD0nNycgaGVpZ2h0PScyMCcgcng9JzUnIHJ5PSc1JyBmaWxsPScjODg4ODg4JyB0cmFuc2Zvcm09J3JvdGF0ZSgyNzAgNTAgNTApIHRyYW5zbGF0ZSgwIC0zMCknPiAgPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0nb3BhY2l0eScgZnJvbT0nMScgdG89JzAnIGR1cj0nLjdzJyBiZWdpbj0nMC41MjVzJyByZXBlYXRDb3VudD0naW5kZWZpbml0ZScvPjwvcmVjdD48cmVjdCAgeD0nNDYuNScgeT0nNDAnIHdpZHRoPSc3JyBoZWlnaHQ9JzIwJyByeD0nNScgcnk9JzUnIGZpbGw9JyM4ODg4ODgnIHRyYW5zZm9ybT0ncm90YXRlKDMwMCA1MCA1MCkgdHJhbnNsYXRlKDAgLTMwKSc+ICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSdvcGFjaXR5JyBmcm9tPScxJyB0bz0nMCcgZHVyPScuN3MnIGJlZ2luPScwLjU4MzMzMzMzMzMzMzMzMzRzJyByZXBlYXRDb3VudD0naW5kZWZpbml0ZScvPjwvcmVjdD48cmVjdCAgeD0nNDYuNScgeT0nNDAnIHdpZHRoPSc3JyBoZWlnaHQ9JzIwJyByeD0nNScgcnk9JzUnIGZpbGw9JyM4ODg4ODgnIHRyYW5zZm9ybT0ncm90YXRlKDMzMCA1MCA1MCkgdHJhbnNsYXRlKDAgLTMwKSc+ICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSdvcGFjaXR5JyBmcm9tPScxJyB0bz0nMCcgZHVyPScuN3MnIGJlZ2luPScwLjY0MTY2NjY2NjY2NjY2NjZzJyByZXBlYXRDb3VudD0naW5kZWZpbml0ZScvPjwvcmVjdD48L3N2Zz4='\n  })\n\n  .factory('preLoader', ['Settings', '$timeout', function (Settings, $timeout) {\n    var listenForEl = function($el, url, successCallback, errorCallback, timeout) {\n      if (successCallback) {\n        $el.one('load', function () {\n          successCallback($el);\n        });\n      }\n\n      if (errorCallback) {\n        $el.one('error', function () {\n          console.log('error', $el[0].src);\n          errorCallback(timeout, $el);\n        });\n      }\n\n      $el.attr('src', url);\n    };\n\n\n    var outdatedTry = function($el, url, timeout, limit, successCallback, errorCallback) {\n      if (Settings.firstStep * Math.pow(Settings.step, limit - 1) === timeout) {\n        return;\n      }\n\n      $timeout(\n        function() {\n          listenForEl($el, url, successCallback, errorCallback, timeout);\n        },\n        timeout\n      );\n    };\n\n    var calculateHeight = function(width, originalWidth, originalHeight) {\n      return (parseInt(width, 10) * parseInt(originalHeight, 10)) / parseInt(originalWidth, 10);\n    };\n\n    return {\n      listenForEl: listenForEl,\n      outdatedTry: outdatedTry,\n      calculateHeight: calculateHeight\n    };\n  }])\n\n  .directive('preloadImage', ['preLoader', '$timeout', '$window', 'Settings',\n    function (preLoader, $timeout, $window, Settings) {\n\n      return {\n        restrict: 'A',\n        terminal: true,\n        priority: 100,\n        link: function (scope, $element, attrs) {\n          var height;\n          var limit = attrs.limit;\n          var spinner = attrs.defaultImage || Settings.defaultSpinner;\n\n          var firstStep = Settings.firstStep;\n          var step = Settings.step;\n          var className = Settings.className;\n          var classNameHeight = Settings.classNameHeight;\n          var $testImage = angular.element(new Image());\n\n          var $spinner = angular.element(new Image()).attr( { 'src': spinner, 'class': className + '-spinner' });\n\n          var successCallback = function() {\n            $element.next().remove();\n            $element.css('max-height', $window.innerHeight + 'px');\n            $timeout(function() {\n              $element.removeClass(className)\n                      .css('height', 'auto')\n                      .css('max-height', 'auto');\n            }, 300);\n            $element.off('load').off('error');\n\n            if (attrs.success) {\n              scope.$apply(attrs.success);\n            }\n          };\n\n          var errorCallback = function(timeout) {\n            preLoader.outdatedTry($element,\n                                  attrs.ngSrc,\n                                  timeout * step || firstStep,\n                                  limit || 0,\n                                  null,\n                                  errorCallback\n                                );\n          };\n\n          attrs.$observe('ngSrc', function(url) {\n            if ($testImage.attr('src', url)[0].complete) {\n              $element.attr('src', url);\n              return;\n            }\n\n            $element.addClass(className).after($spinner);\n\n            if (attrs.height && attrs.width) {\n              height = preLoader.calculateHeight($element.prop('offsetWidth'), attrs.width, attrs.height);\n              $spinner.css('margin-top', (height / 2) - ($spinner.prop('offsetHeight') / 2) + 'px');\n\n              $element.addClass(classNameHeight)\n                      .css('height', height + 'px')\n                      .css('max-height', height + 'px');\n            } else {\n              $spinner.css('margin-top', '0px');\n            }\n\n            preLoader.outdatedTry($element,\n                                  url,\n                                  0,\n                                  limit || 0,\n                                  successCallback,\n                                  errorCallback);\n          });\n\n          scope.$on('$destroy', function() {\n            $element.off('load').off('error');\n            $testImage.remove();\n            successCallback = function() {};\n            errorCallback = function() {};\n          });\n        }\n      };\n    }\n  ])\n\n  .directive('preloadBgImage', ['preLoader', '$timeout', 'Settings',\n    function (preLoader, $timeout, Settings) {\n\n      return {\n        restrict: 'A',\n        priority: 99,\n        link: function (scope, $element, attrs) {\n          var className = Settings.bgClassName;\n          var url;\n\n          var firstStep = Settings.firstStep;\n          var step = Settings.step;\n\n          var limit = attrs.limit;\n          var spinner = attrs.defaultImage || Settings.defaultSpinner;\n\n          var disconnectWatchers = function() {\n            errorCallback = function() {};\n            successCallback = function() {};\n          };\n\n          var successCallback = function($el) {\n            $element.css({\n              'background-image': 'url(\"' + url + '\")'\n            });\n            $el.off('load').off('error').remove();\n            $element.removeClass(className);\n\n\n            if (attrs.success) {\n              scope.$apply(attrs.success);\n            }\n          };\n\n          var errorCallback = function(timeout, $el) {\n            preLoader.outdatedTry(\n              $el,\n              url,\n              timeout * step || firstStep,\n              limit || 0,\n              null,\n              errorCallback\n            );\n          };\n\n          attrs.$observe('preloadBgImage',\n            function(_url) {\n\n              if (!_url) {\n                $element.css('background-image', '');\n                return;\n              } else {\n                url = _url;\n              }\n\n              $element.addClass(className);\n              $element.css({\n                'background-image': 'url(\"' + spinner + '\")'\n              });\n\n              preLoader.outdatedTry(\n                angular.element(new Image()),\n                url,\n                0,\n                limit || 0,\n                successCallback,\n                errorCallback);\n\n            }, true);\n\n          scope.$on('$destroy', disconnectWatchers);\n        },\n        scope: true\n      };\n    }\n  ]);\n\n})(angular);"],"sourceRoot":"/source/"}